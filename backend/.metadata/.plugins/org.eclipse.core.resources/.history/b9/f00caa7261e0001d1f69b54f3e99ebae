package br.senai.sp.cadastro.dao;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.jdbc.core.BeanPropertyRowMapper;
import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.stereotype.Repository;

import br.senai.sp.cadastro.model.Cliente;
import br.senai.sp.livro.model.Livro;

@Repository
public class ClienteDao {
	
    @Autowired
    JdbcTemplate  jdbcTemplate;

	public List<Cliente> listarTodos() {
	    String sql = "SELECT idCliente, nome, cpf, email, telefone, dataNascimento, login, senha";
	     
	    List<Cliente> lista = jdbcTemplate.query(sql,
	                BeanPropertyRowMapper.newInstance(Cliente.class));

		return lista;
	}
	
	
	public Cliente pegarPorId(int idCliente) {
		
	    String sql = "SELECT idCliente, nome, cpf, email, telefone, dataNascimento, login, senha FROM cliente WHERE idCliente=?";
	    
		Object[] params = {idCliente};
	    
		Cliente produto = jdbcTemplate.queryForObject(sql,
	        BeanPropertyRowMapper.newInstance(Cliente.class), params);
	    
		return produto;
	}
	
	public Integer novo(Cliente cliente) {
		
        String sql = "INSERT INTO cliente (nome, cpf, email, telefone, dataNascimento, login, senha) "
        		+ "VALUES (?, ?, ?, ?, ?, ?, ?)";
        int result = jdbcTemplate.update(sql, 
        		cliente.getNome(),
        		cliente.getCpf(),
        		cliente.getEmail(),
         	    cliente.getTelefone(),
        	    cliente.getDataNascimento(),
        	    cliente.getLogin(),
        	    cliente.getSenha()
        		);
		
		return result;
	}
	
	
	public void criarListaCliente(List<Cliente> clientes) {
	    for (Cliente cliente : clientes) {
	        novo(cliente);
	    }
	}


	
	public int editar(Cliente cliente, int idCliente) {
		String sql = "UPDATE cliente SET nome=?, cpf=?, email=?, telefone=?, dataNascimento=?, login=?, senha=? WHERE idCliente=?";
		
	    Object[] params = {
        		cliente.getNome(),
        		cliente.getCpf(),
        		cliente.getEmail(),
        	    cliente.getTelefone(),
        	    cliente.getDataNascimento(),
        	    cliente.getLogin(),
        	    cliente.getSenha(),
        	    idCliente};
	    
	    int result = jdbcTemplate.update(sql, params);
	     
		return result;
	}
	
	public int deletar(int idCliente) {
		
		String sql = "DELETE FROM cliente WHERE idCliente=?";
		
		Object[] params = {idCliente};
		
		int result = jdbcTemplate.update(sql, params);
		
		return result;
	}
	
	
	public Cliente[] buscarPorValor(String valor) {
	    String sql = "SELECT idCliente, nome, cpf, email, telefone, dataNascimento"
	            + "FROM cliente "
	            + "WHERE nome cpf ? "
	            + "OR TITULO email ? "
	            + "OR AUTOR telefone ? "
	            + "OR GENERO dataNascimento ? ";

	    List<Cliente> clientes = jdbcTemplate.query(sql, ps -> {
	        ps.setString(1, "%" + valor + "%");
	        ps.setString(2, "%" + valor + "%");
	        ps.setString(3, "%" + valor + "%");
	        ps.setString(4, "%" + valor + "%");
	        ps.setString(5, "%" + valor + "%");
	    }, BeanPropertyRowMapper.newInstance(Cliente.class));

	    return clientes.toArray(new Cliente[0]);
	}
	
	
}